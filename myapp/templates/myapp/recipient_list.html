{% extends "myapp/base.html" %}

{% block content %}
<div class="card p-4 shadow-lg">
  <h3 class="mb-4">Recipients</h3>

  <table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
  <tr>
    <th>Email</th>
    <th>Subscribed</th>
    <th>Unsubscribed At</th>
    <th class="text-end">Actions</th>
  </tr>
</thead>

    <tbody>
      {% for r in recipients %}
        <tr>
  <td>{{ r.email }}</td>

  <td>
    {% if r.is_subscribed %}
      <span class="badge bg-success">Yes</span>
    {% else %}
      <span class="badge bg-danger">No</span>
    {% endif %}
  </td>

  <td>{{ r.unsubscribed_at|default:"â€”" }}</td>

  <td class="text-end">
    <button type="button"
        class="btn btn-sm btn-outline-danger"
        data-bs-toggle="modal"
        data-bs-target="#deleteRecipientModal{{ r.id }}">
  Delete
</button>

  </td>
</tr>

      {% empty %}
        <tr>
          <td colspan="3" class="text-center text-muted">
            No recipients found
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% for r in recipients %}
<div class="modal fade"
     id="deleteRecipientModal{{ r.id }}"
     tabindex="-1"
     aria-hidden="true">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title text-danger">Confirm delete</h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        Are you sure you want to delete
        <strong>{{ r.email }}</strong>?
      </div>

      <div class="modal-footer">
        <button type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal">
          Cancel
        </button>

        <form method="post"
              action="{% url 'recipient_delete' r.id %}">
          {% csrf_token %}
          <button type="submit"
        class="btn btn-danger"
        onclick="forceCloseModal()">
  Yes, delete
</button>

        </form>
      </div>

    </div>
  </div>
</div>
{% endfor %}

{% endblock %}
